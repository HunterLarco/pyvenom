<!DOCTYPE html>
<html>
<head>
<style>

body{
  display:flex;
  flex-direction:row;
  
  font-family:helvetica, Arial;
  font-size:16px;
  
  color:rgb(235,235,235);
  background:rgb(31,31,31);
}
sidebar{
  display:block;
  min-width:250px;
  
  background:rgb(255,255,255);
  color:rgb(51,51,51);
}
content{
  display:block;
  flex:2;
}

sidebar logo,
sidebar label,
sidebar item{
  display:block;
  padding:14px 16px;
  background:rgb(255,255,255);
  
  cursor:default;
}

sidebar label{
  border-top:1px solid rgb(200,200,200);
  color:rgb(158,158,158);
  background:rgb(245,245,245);
  padding:16px 16px;
  
  font-size:12px;
  text-transform:uppercase;
}
sidebar img{
  display:inline-block;
  vertical-align:middle;
  
  height:24px;
  width:24px;
  padding-right:10px;
}

sidebar item{
  padding:14px 24px;
  cursor:pointer;
}
sidebar item:hover{
  text-decoration:underline;
}

content centered{
  display:flex;
  flex-direction:row;
  
  max-width:900px;
  margin:50px auto;
}

content scripts{
  flex-shrink: 0
}
content responses{
  display:flex;
  flex:2;
  flex-direction:column;
  
  word-break:break-word;
  overflow: auto;
}

content pre{
  padding:14px;
  
  font-family:monospace;
  font-size:14px;
  color:rgb(200,200,200);
  
  max-width:100%;
}

content border,
content pre{
  display:block;
  
  border:1px solid rgb(120,120,120);
  margin:6px;
  
  overflow:scroll;
}

content scripts item,
content scripts h1{
  display:block;
  
  padding:10px 14px;
  margin:0px;
  
  cursor:default;
}
content scripts item{
  cursor:pointer;
}
content scripts item:hover{
  text-decoration:underline;
}
content scripts h1{
  background:rgb(51,51,51);
  border-bottom:1px solid rgb(80,80,80);
}

</style>

<title>Venom Scripts</title>

<meta charset='utf-8'/>

<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='mobile-web-app-capable' content='yes'>

<meta content='minimum-scale=1.0, width=device-width, maximum-scale=1, user-scalable=no' name='viewport'/>

<link rel='stylesheet' href='resources/css/resets.css'/>

</head>
<body>


<sidebar>
  <logo>Venom</logo>
  
  <label>Development Tools</label>
  <a href='scripts'><item><img src='images/scripts.svg'/>Scripts</item></a>
  <a href='scaffold'><item><img src='images/scaffold.svg'/>Scaffold</item></a>
  
  <label>Analytics</label>
  <a href='endpoints'><item><img src='images/endpoints.svg'/>Endpoints</item></a>
  <a href='models'><item><img src='images/models.svg'/>Models</item></a>
</sidebar>

<content>
  <centered>
    
    <scripts>
      <border>
        <h1>Scripts</h1>
        {% for script in scripts %}
        <item>{{ script }}</item>
        {% endfor %}
      </border>
    </scripts>
    
    <responses>
      <pre>shell ready</pre>
    </responses>
    
  </centered>
</content>


<script>
(function(){
  
  var responses;
  
  window.addEventListener('load', Init);
  function Init(){
    responses = document.querySelector('responses');
    BindScripts();
  }
  
  function BindScripts(){
    var scripts = document.querySelectorAll('scripts item');
    for(var i=0,script; script=scripts[i++];)
      (function(script){
        script.addEventListener('click', function(){
          
          var pre = CreatePre();
          pre.write('> EXECUTING ' + script.innerHTML);
          pre.pend();
          
          fetch('scripts/execute/' + script.innerHTML, {
          	method: 'post',
            credentials: 'same-origin'
          }).then(function(response) {
	          return response.json();
          }).then(function(json){
            LogOutput(pre, json)
          }).catch(function(err) {
          	// Error :(
          });
          
        });
      })(script);
  }
  
  function CreatePre(){
    var pre = document.createElement('pre');
    
    var interval;
    var pending = ['/', '-', '\\', '|'];
    var index = 0;
    
    function UpdatePend(){
      pre.innerHTML = pre.innerHTML.split('\n').slice(0, -1).join('\n') + '\n' + pending[index++];
      index %= pending.length;
    }
    
    responses.appendChild(pre);
    
    return {
      'pend': function(){
        pre.innerHTML += '\n';
        UpdatePend();
        interval = setInterval(UpdatePend, 150);
      },
      'stop': function(){
        if(interval)
          pre.innerHTML = pre.innerHTML.split('\n').slice(0, -1).join('\n');
        clearInterval(interval);
      },
      'write': function(value){
        pre.innerHTML += (pre.innerHTML ? '\n' : '') + value;
      }
    }
  }
  function LogOutput(pre, json){
    pre.stop();
    for(var i=0; i<json.printed.length; i++){
      var line = json.printed[i];
      pre.write(line);
    }
    pre.write('< '+ json.returned);
    pre.scrollTop = pre.scrollHeight
  }
  
})();
</script>
</body>
</html>